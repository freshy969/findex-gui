{% extends "bucket/templates/base.html" %}
{% block content %}

<style>
@media(min-width:768px) {
    #wrapper {
        padding-left: 250px;
    }
}
</style>
<!-- Sidebar -->
<div id="sidebar-wrapper">
    <ul class="sidebar-nav">
        <li class="header">
            <div class="cont">
                <div class="icon">
                    <img height="70px" src="{{ url_for("static", filename="img/default_thumbnail2.png") }}"/>
                </div>
                <div class="description">
                    <b style="color: #5D5D5D">{{ browser.resource.server.name }}</b>

                    <p style="font-size:12px;color: #969696">{{ browser.resource.meta.file_count }} {{ _('files') }}
                    <br>
                    id: {{ browser.resource.id }}
                    </p>
                </div>
                <div class="hide_sidebar">
                    <i class="fa fa-arrow-left" aria-hidden="true"></i>
                </div>
            </div>
        </li>

        {% if browser.file_distribution %}
            <div class="file_distribution_container">
                <span id="header">{{ _('File distribution') }}</span>
                {% for key, val in browser.file_distribution.iteritems() %}
                    <div class="skillbar clearfix " data-percent="{{ val }}%">
                        <div class="skillbar-title"><span>{{ key }}</span></div>
                        <div class="skillbar-bar"></div>
                        <div class="skill-bar-percent">{{ val }}%</div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <hr>

{#        <li>#}
{#            <a href="#">#}
{#                <i class="fa fa-info-circle">#}
{#                    <span>{{ _('Report Offline') }}</span>#}
{#                </i>#}
{#            </a>#}
{#        </li>#}
        <li>
            <a href="{{ url_for("search_home") }}">
                <i class="fa fa-info-circle">
                    <span>{{ _('Search') }}</span>
                </i>
            </a>
        </li>
    </ul>
</div>
<!-- /#sidebar-wrapper -->

<!-- Page Content -->
<div id="page-content-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12" style="padding-left:24px;">

                <h3 style="padding-bottom: 0px;margin-bottom: 4px;">{{ browser.breadcrumbs[breadcrumbs|length-2] }}</h3>
                <ol class="breadcrumbs">
                    {% for i in range(0, browser.breadcrumbs | length) %}
                        {% set crumb = browser.breadcrumbs[i] %}
                        {% set href = ('../'*(browser.breadcrumbs | length - i-2))[:-1] %}

                        {% if i+2 == browser.breadcrumbs | length %}
                            {% set active = True %}
                        {% else %}
                            {% set active = False %}
                        {% endif %}

                        <li>
                            <a class="{{"active" if active else "unactive"}}" href="{{href if not active else "."}}/">{{crumb}}</a>
                        </li>
                    {% endfor %}
                </ol>
            </div>
            <div class="col-lg-12">
                {% if browser.files %}
                    {% include 'bucket/templates/main/_file_browser.html' %}

                        <div class="btn-group">
                            <a class="btn btn-default">Raw</a>
                            <a class="btn btn-default">JSON</a>
                            <a href="{{ url_for("index_as_csv", args={})[:-1] }}{{ browser.resource.resource_id }}/" class="btn btn-default">CSV</a>
                            <script>
                                $(document).on('click', '.dropdown-menu', function (e) {
                                  e.stopPropagation();
                                });
                            </script>
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false">{{ _('Fetch') }}
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu" style="width:500px;">
                                <style>
                                    .fetch_container textarea{
                                        font-size: 14px;
                                        min-height: 80px;
                                        background-color: #e9e9e9;
                                        color: #989898;
                                        font-weight: bold;
                                        padding-top: 10px;
                                    }
                                </style>
                                <div class="fetch_container" style="width:500px !important;">
                                    <p style="margin-bottom:20px;">
                                        {{ _('Recursively fetch the current directory') }}.
                                    </p>
                                    {% set dir = browser.resource.protocol_human + "://" + browser.resource.server.address + "/" + "/".join(browser.breadcrumbs[1:]) %}
                                    <h4>wget</h4>
                                    <textarea style="font-size: 14px;min-height: 80px;">wget --user=anonymous --password='anonymous' -r -nH -nd -np "{{dir}}"</textarea>
                                    <h4>lftp</h4>
                                    <textarea style="font-size: 14px;min-height: 80px;">lftp -u anonymous,anonymous -e 'mirror -c' '{{dir}}'</textarea>
                                </div>
                            </ul>
                        </div>
                {% else %}
                    <div class="alert alert-info alert-xs" style="margin-top:20px;max-width:300px;padding: 8px;">
                        <i class="fa fa-bell-o">
                        <span style="margin-left:2px;">{{ _('no files') }}</span>
                        </i>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $(".hide_sidebar").click(function (e) {
            e.preventDefault();
            $("#wrapper").toggleClass("toggled");
        });

        $('.skillbar').each(function(){
            $(this).find('.skillbar-bar').css({
                width:$(this).attr('data-percent')
            });
        });
    });
</script>
{% endblock %}