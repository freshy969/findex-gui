{% extends "bucket/templates/base.html" %}
{% block content %}
<link href="{{ url_for("static", filename="themes/bucket/static/css/browse.css") }}" rel="stylesheet">
<style>
@media(min-width:768px) {
    #wrapper {
        padding-left: 250px;
    }
}
</style>
<!-- Sidebar -->
<div id="sidebar-wrapper">
    <ul class="sidebar-nav">
        <li class="header">
            <div class="cont">
                <div class="icon">
                    <img height="70px" src="{{ url_for("static", filename="img/default_thumbnail2.png") }}"/>
                </div>
                <div class="description">
                    <b style="color: #5D5D5D">{{ resource.server.name }}</b>

                    <p style="font-size:12px;color: #969696">{{ resource.meta.file_count }} {{ _('files') }}
                    <br>
                    id: {{ resource.id }}
                    </p>
                </div>
                <div class="hide_sidebar">
                    <i class="fa fa-arrow-left" aria-hidden="true"></i>
                </div>
            </div>
        </li>

        {% if file_distribution %}
            <div class="file_distribution_container">
                <span id="header">{{ _('File distribution') }}</span>
                {% for key, val in file_distribution.iteritems() %}
                    <div class="skillbar clearfix " data-percent="{{ val }}%">
                        <div class="skillbar-title"><span>{{ key }}</span></div>
                        <div class="skillbar-bar"></div>
                        <div class="skill-bar-percent">{{ val }}%</div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <hr>

{#        <li>#}
{#            <a href="#">#}
{#                <i class="fa fa-info-circle">#}
{#                    <span>{{ _('Report Offline') }}</span>#}
{#                </i>#}
{#            </a>#}
{#        </li>#}
        <li>
            <a href="{{ url_for("search_home") }}">
                <i class="fa fa-info-circle">
                    <span>{{ _('Search') }}</span>
                </i>
            </a>
        </li>
    </ul>
</div>
<!-- /#sidebar-wrapper -->

<!-- Page Content -->
<div id="page-content-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12" style="padding-left:24px;">
                <h3 style="padding-bottom: 0px;margin-bottom: 4px;">{{ breadcrumbs[breadcrumbs|length-2] }}</h3>
                <ol class="breadcrumbs">
                    {% for i in range(0, breadcrumbs | length) %}
                        {% set crumb = breadcrumbs[i] %}
                        {% set href = ('../'*(breadcrumbs | length - i-2))[:-1] %}

                        {% if i+2 == breadcrumbs | length %}
                            {% set active = True %}
                        {% else %}
                            {% set active = False %}
                        {% endif %}

                        <li>
                            <a class="{{"active" if active else "unactive"}}" href="{{href if not active else "."}}/">{{crumb}}</a>
                        </li>
                    {% endfor %}
                </ol>
            </div>
            <div class="col-lg-12">
                {% if files %}
                    <table class="browser table">
                        <thead>
                            <tr>
                                <th>Filename</th>
                                <th style="width:80px;">Size</th>
                                <th style="width:80px;">Perm</th>
                                <th style="width:110px;">Modified</th>
                                <th style="width:80px;">Direct</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for f in files %}
                                {% if f.file_isdir %}
                                    {% if f.file_name == ".." %}
                                        {% set icon = "fa-level-up" %}
                                        {% set href = ".." %}
                                    {% else %}
                                        {% set icon = "fa-folder" %}
                                        {% set href = f.file_name + "/" %}
                                    {% endif %}
                                {% else %}
                                    {% set icon = "fa-file-text-o" %}
                                    {% set href = f.file_name %}
                                {% endif %}

                                <tr class="clickable text-nowrap" data-id="{{f.id}}" data-href="{{href}}" rel="popover" title="">
                                    <td><i class="fa {{ icon }}"></i>
                                        <a href="{{ href }}">{{f.file_name}}</a>
                                    </td>

                                    <td><b>{{f.file_size_human}}</b></td>
                                    <td>-</td>
                                    <td>{{f.file_modified_human}}</td>
                                    <td>
                                        {% if not f.file_isdir %}
                                            <a target="_blank" href="{{ f.path_direct }}">src</a>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                        <div class="btn-group">
                            <a class="btn btn-default">Raw</a>
                            <a class="btn btn-default">JSON</a>
                            <a href="{{ url_for("index_as_csv", parsed=[])[:-1] }}{{ resource.resource_id }}/" class="btn btn-default">CSV</a>
                            <script>
                                $(document).on('click', '.dropdown-menu', function (e) {
                                  e.stopPropagation();
                                });
                            </script>
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false">{{ _('Fetch') }}
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu" style="width:500px;">
                                <style>
                                    .fetch_container textarea{
                                        font-size: 14px;
                                        min-height: 80px;
                                        background-color: #e9e9e9;
                                        color: #989898;
                                        font-weight: bold;
                                        padding-top: 10px;
                                    }
                                </style>
                                <div class="fetch_container" style="width:500px !important;">
                                    <p style="margin-bottom:20px;">
                                        {{ _('Recursively fetch the current directory') }}.
                                    </p>
                                    {% set dir = resource.protocol_human + "://" + resource.server.address + "/" + "/".join(breadcrumbs[1:]) %}
                                    <h4>wget</h4>
                                    <textarea style="font-size: 14px;min-height: 80px;">wget --user=anonymous password='33c3@l0l.ru' -r -nH -nd -np "{{dir}}"</textarea>
                                    <h4>lftp</h4>
                                    <textarea style="font-size: 14px;min-height: 80px;">lftp -u anonymous,33c3@l0l.ru -e 'mirror -c' '{{dir}}'</textarea>
                                </div>
                            </ul>
                        </div>
                {% else %}
                    {{ _('no files') }}
                {% endif %}
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $(".hide_sidebar").click(function (e) {
            e.preventDefault();
            $("#wrapper").toggleClass("toggled");
        });

        $('.skillbar').each(function(){
            $(this).find('.skillbar-bar').css({
                width:$(this).attr('data-percent')
            });
        });
    });
</script>
{% endblock %}